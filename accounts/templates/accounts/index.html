{% load static %}
<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ì¢…í•© í€´ì¦ˆ</title>
    <link rel="stylesheet" href="{% static 'css/styles.css' %}" />
    <link rel="icon" href="data:;base64,iVBORw0KGgo=" />
    <script src="{% static 'js/script.js' %}" defer></script>
    <script
      src="https://unpkg.com/@dotlottie/player-component@2.7.12/dist/dotlottie-player.mjs"
      type="module"
    ></script>
  </head>
  <body>
    <header>
      <div class="loginDivPa">
        {% if request.user.is_authenticated %}
        <div class="loginDivCh welcomeMsg">
          {{ request.user.username }}ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤!
        </div>
        <a class="loginDivCh" href="quiz/my_results">ë‚´ ê¸°ë¡ ì¡°íšŒ</a>
        <div class="loginDivCh logout">
          <a href="{% url 'logout' %}">ë¡œê·¸ì•„ì›ƒ</a>
        </div>
        {% else %}
        <div class="loginDivCh login">
          <a href="{% url 'login' %}">ë¡œê·¸ì¸</a>
        </div>
        <div class="loginDivCh joinMember">
          <a href="{% url 'signup' %}">íšŒì›ê°€ì…</a>
        </div>
        {% endif %}
      </div>
      <div class="settings-button" onclick="toggleSettings()">âš™ï¸</div>
    </header>

    <!-- ì„¤ì • íŒ¨ë„ -->
    <div class="settings-panel" id="settingsPanel">
      <h3>ğŸ”§ ì„¤ì •</h3>
      <div class="setting-item">
        <label>BGM ë³¼ë¥¨ ğŸµ</label>
        <input type="range" id="bgmVolume" min="0" max="1" step="0.01" />
      </div>
      <div class="setting-item">
        <label>íš¨ê³¼ìŒ ë³¼ë¥¨ ğŸ§</label>
        <input type="range" id="sfxVolume" min="0" max="1" step="0.01" />
      </div>
      <div class="setting-item">
        <label>BGM ì¢…ë¥˜</label>
        <select id="bgmSelector">
          <option value="bgm1.mp3">ê¸°ë³¸ ìŒì•…</option>
          <option value="bgm2.mp3">ì‹ ë‚˜ëŠ” ìŒì•…</option>
          <option value="bgm3.mp3">ì§‘ì¤‘ìš© ìŒì•…</option>
        </select>
      </div>
    </div>

    <!-- BGM & íš¨ê³¼ìŒ ì˜¤ë””ì˜¤ -->
    <audio
      id="bgmPlayer"
      src="{% static 'audio/bgm1.mp3' %}"
      autoplay
      loop
    ></audio>
    <audio id="sfxPlayer" src="{% static 'audio/click.mp3' %}"></audio>

    <main>
      <!-- ì¹´í…Œê³ ë¦¬ ì„ íƒ í™”ë©´ -->
      <div id="categoryContainer" class="container">
        <div class="title">
          <h1>ì¢…í•© í€´ì¦ˆ</h1>
          <p>ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”!</p>
        </div>
        <section id="categories">
          <button class="catBtn" data-cat="it">IT</button>
          <button class="catBtn" data-cat="sports">ìŠ¤í¬ì¸ </button>

          <button class="catBtn" data-cat="literature">ë¬¸í•™</button>
          <button class="catBtn" data-cat="art">ì˜ˆìˆ </button>

          <button class="catBtn" data-cat="economy">ê²½ì œ</button>
          <button class="catBtn" data-cat="proverb">ì†ë‹´/ì‚¬ìì„±ì–´</button>

          <button class="catBtn" data-cat="history">ì—­ì‚¬</button>
          <button class="catBtn" data-cat="commonSense">ìƒì‹</button>

          <button class="catBtn" id="userQuizzesBtn">ë‹¤ë¥¸ ì‚¬ìš©ì ë¬¸ì œ</button>

          <button onclick="location.href='/quiz/ranking/'" class="catBtn">
            ë­í‚¹ ë³´ê¸°
          </button>
        </section>
      </div>

      <!-- ë‚œì´ë„ ì„ íƒ í™”ë©´ -->
      <div id="difficultyContainer" class="container" style="display: none">
        <div class="title">
          <h1 id="difficultyTitle"></h1>
          <p>ë‚œì´ë„ë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”!</p>
        </div>
        <section id="difficultyOptions">
          <button class="difficultyBtn" id="difficultymeunBtn">ğŸ ï¸</button>
          <button class="difficultyBtn" data-difficulty="easy">ì´ì§€</button>
          <button class="difficultyBtn" data-difficulty="medium">ë…¸ë§</button>
          <button class="difficultyBtn" data-difficulty="hard">í•˜ë“œ</button>
        </section>
      </div>

      <!-- í€´ì¦ˆ ì§„í–‰ í™”ë©´ -->
      <div
        id="quizContainer"
        class="container"
        style="display: none; position: relative"
      >
        <div
          id="timer"
          style="position: absolute; font-weight: bold; text-align: left"
        >
          âŒ›: <span id="timerValue">0</span>ì´ˆ
        </div>
        <div
          id="progress"
          style="position: absolute; font-weight: bold; right: 30px"
        ></div>
        <div class="title">
          <h3 id="quizTitle" style="align-items: center"></h3>
        </div>
        <section class="quiz">
          <div id="question" class="question">ë¬¸ì œê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</div>
          <ul id="options" class="options">
            <!-- ì˜µì…˜ ë²„íŠ¼ë“¤ì´ ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤. -->
          </ul>
        </section>
        <footer>
          <p id="final" class="result"></p>
          <button id="menuBtn" style="float: left">ğŸ ï¸</button>
        </footer>
      </div>
      <div id="resultContainer" class="container" style="display: none">
        <div id="result" class="result"></div>
        <button id="nextBtn" class="actionBtn">ë‹¤ìŒ ë¬¸ì œ</button>
      </div>
    </main>

    <script>
      const bgmPlayer = document.getElementById('bgmPlayer');
      const sfxPlayer = document.getElementById('sfxPlayer');
      const bgmVolume = document.getElementById('bgmVolume');
      const sfxVolume = document.getElementById('sfxVolume');
      const bgmSelector = document.getElementById('bgmSelector');
      const settingsPanel = document.getElementById('settingsPanel');

      function toggleSettings() {
        settingsPanel.classList.toggle('visible');
      }

      bgmVolume.addEventListener('input', () => {
        bgmPlayer.volume = bgmVolume.value;
      });

      sfxVolume.addEventListener('input', () => {
        sfxPlayer.volume = sfxVolume.value;
      });

      bgmSelector.addEventListener('change', () => {
        bgmPlayer.src = `{% static 'audio/' %}` + bgmSelector.value;
        bgmPlayer.play();
      });

      // ë²„íŠ¼ íš¨ê³¼ìŒ ì ìš© ì˜ˆì‹œ
      document.querySelectorAll('button').forEach((btn) => {
        btn.addEventListener('click', () => {
          sfxPlayer.currentTime = 0;
          sfxPlayer.play();
        });
      });

      document
        .getElementById('userQuizzesBtn')
        .addEventListener('click', function () {
          window.location.href = "{% url 'user_quizzes' %}";
        });
    </script>

    <style>
      .settings-button {
        position: absolute;
        right: 1rem;
        top: 1rem;
        font-size: 1.5rem;
        cursor: pointer;
      }
      .settings-panel {
        position: absolute;
        right: 1rem;
        top: 3.5rem;
        background: white;
        border-radius: 8px;
        padding: 1rem;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        width: 200px;
        display: none;
        z-index: 10;
      }
      .settings-panel.visible {
        display: block;
      }
      .setting-item {
        margin-bottom: 1rem;
      }
    </style>
  </body>
</html>
